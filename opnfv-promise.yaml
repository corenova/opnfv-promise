name: opnfv-promise
description: Resource Management for Virtualized Infrastructure
author: Peter K. Lee <peter@intercloud.net>
license: Apache-2.0
homepage: http://wiki.opnfv.org/promise
repository: git://github.com/opnfv/promise.git
keywords:
  - opnfv
  - promise
  - vim
  - nfvi
  - infrastructure
  - openstack
  - nbi
  - yangforge
  - resource
  - reservation
  - capacity
  - allocation

schema: !yang/schema opnfv-promise.yang
#config: !json        opnfv-promise.json

dependencies:
  nfv-infrastructure: !yang/schema nfv-infrastructure.yang
  nfv-mano:           !yang/schema nfv-mano.yang

model:
  ResourceReservation:
    validate: !coffee/function |
      (value, options) ->
        # first will need to check if reservation is OK
        for k, v of value.capacity when v?
          hasCapacity = true
        if (not hasCapacity) and value.resources.length is 0
          return false
        return true

#RPC definitions
rpc:
  create-reservation: !coffee/function |
    (input, output, done) ->
      try
        reservation = @create 'ResourceReservation', input.get()
        # here we need to access the reservation-service feature and check to see if OK

      catch e
        output.set 'result', 'error'
        output.set 'message', e
        return done e

      # assume reservation successful
      reservation.save()
      .then =>
        (@access 'promise.reservations').push reservation
        output.set 'result', 'ok'
        output.set 'message', 'request accepted'
        output.set 'reservation-id', (reservation.get 'id')
        done()
      .catch (e) -> done e
